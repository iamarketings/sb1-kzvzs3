<%- include('../layouts/header') %>

<main class="container">
    <div class="dashboard">
        <div class="dashboard-header">
            <h2>Configuration du Chatbot</h2>
            <div class="wizard-progress">
                <div class="step active" data-step="1">Type</div>
                <div class="step" data-step="2">Profil</div>
                <div class="step" data-step="3">Données</div>
                <div class="step" data-step="4">Intégration</div>
            </div>
        </div>

        <div class="wizard-form">
            <form action="/chatbot/create" method="POST" id="chatbotForm">
                <!-- Step 1: Type -->
                <div class="wizard-step active" data-step="1">
                    <h3>Type d'utilisation</h3>
                    <div class="choice-grid">
                        <div class="choice-card">
                            <input type="radio" id="type-business" name="usage_type" value="business">
                            <label for="type-business">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 7h-9"/><path d="M14 17H5"/><circle cx="17" cy="17" r="3"/><circle cx="7" cy="7" r="3"/></svg>
                                <h4>Entreprise</h4>
                                <p>Pour usage professionnel et commercial</p>
                            </label>
                        </div>
                        <div class="choice-card">
                            <input type="radio" id="type-personal" name="usage_type" value="personal">
                            <label for="type-personal">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
                                <h4>Personnel</h4>
                                <p>Pour usage privé et personnel</p>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Step 2: Profile -->
                <div class="wizard-step" data-step="2">
                    <h3>Profil du Chatbot</h3>
                    <div class="choice-grid">
                        <div class="choice-card">
                            <input type="radio" id="profile-legal" name="profile_type" value="legal" data-flowid="1145dca6-debe-4456-af2e-39b3cc699632">
                            <label for="profile-legal">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2H2v20h20V2h-8z"/><path d="M16 2v4h4"/><path d="M8 10h8"/><path d="M8 14h8"/><path d="M8 18h8"/></svg>
                                <h4>Assistant Juridique</h4>
                                <p>Conseils juridiques et légaux</p>
                            </label>
                        </div>
                        <div class="choice-card">
                            <input type="radio" id="profile-accounting" name="profile_type" value="accounting">
                            <label for="profile-accounting">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16"/><path d="M4 8h16"/><path d="M4 12h16"/><path d="M4 16h16"/><path d="M4 20h16"/></svg>
                                <h4>Assistant Comptable</h4>
                                <p>Gestion comptable et financière</p>
                            </label>
                        </div>
                        <div class="choice-card">
                            <input type="radio" id="profile-customer" name="profile_type" value="customer">
                            <label for="profile-customer">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
                                <h4>Service Client</h4>
                                <p>Support et assistance client</p>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Step 3: Data Source -->
                <div class="wizard-step" data-step="3">
                    <h3>Source des Données</h3>
                    <div class="choice-grid">
                        <div class="choice-card">
                            <input type="radio" id="data-cloud" name="data_source" value="cloud">
                            <label for="data-cloud">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 10h-1.26A8 8 0 1 0 9 20h9a5 5 0 0 0 0-10z"/></svg>
                                <h4>Cloud Flowise</h4>
                                <p>Données hébergées sur Flowise</p>
                            </label>
                        </div>
                        <div class="choice-card">
                            <input type="radio" id="data-local" name="data_source" value="local">
                            <label for="data-local">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="2" width="20" height="8" rx="2" ry="2"/><rect x="2" y="14" width="20" height="8" rx="2" ry="2"/><line x1="6" y1="6" x2="6.01" y2="6"/><line x1="6" y1="18" x2="6.01" y2="18"/></svg>
                                <h4>Local</h4>
                                <p>Données hébergées localement</p>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Step 4: Integration -->
                <div class="wizard-step" data-step="4">
                    <h3>Type d'Intégration</h3>
                    <div class="choice-grid">
                        <div class="choice-card">
                            <input type="radio" id="integration-website" name="integration_type" value="website">
                            <label for="integration-website">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="3" width="20" height="14" rx="2" ry="2"/><line x1="8" y1="21" x2="16" y2="21"/><line x1="12" y1="17" x2="12" y2="21"/></svg>
                                <h4>Site Web</h4>
                                <p>Code à intégrer sur votre site</p>
                            </label>
                        </div>
                        <div class="choice-card">
                            <input type="radio" id="integration-portal" name="integration_type" value="portal">
                            <label for="integration-portal">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/><line x1="3" y1="9" x2="21" y2="9"/><line x1="9" y1="21" x2="9" y2="9"/></svg>
                                <h4>Portail Web</h4>
                                <p>Page web dédiée</p>
                            </label>
                        </div>
                        <div class="choice-card">
                            <input type="radio" id="integration-whatsapp" name="integration_type" value="whatsapp">
                            <label for="integration-whatsapp">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"/></svg>
                                <h4>WhatsApp</h4>
                                <p>Intégration WhatsApp Business</p>
                            </label>
                        </div>
                    </div>
                </div>

                <input type="hidden" name="flowiseId" id="flowiseId">
                <input type="hidden" name="flowiseHost" value="https://flowise.iamarketings.fr">

                <div class="wizard-controls">
                    <button type="button" class="btn-secondary prev-step" style="display: none;">Précédent</button>
                    <button type="button" class="btn-primary next-step">Suivant</button>
                    <button type="submit" class="btn-primary submit-wizard" style="display: none;">Créer le Chatbot</button>
                </div>
            </form>
        </div>
    </div>
</main>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const form = document.getElementById('chatbotForm');
    const steps = document.querySelectorAll('.wizard-step');
    const progressSteps = document.querySelectorAll('.wizard-progress .step');
    const nextBtn = document.querySelector('.next-step');
    const prevBtn = document.querySelector('.prev-step');
    const submitBtn = document.querySelector('.submit-wizard');
    const flowiseIdInput = document.getElementById('flowiseId');
    let currentStep = 1;

    function updateStep(step) {
        steps.forEach(s => s.classList.remove('active'));
        progressSteps.forEach(s => s.classList.remove('active'));
        
        document.querySelector(`.wizard-step[data-step="${step}"]`).classList.add('active');
        for (let i = 1; i <= step; i++) {
            document.querySelector(`.wizard-progress .step[data-step="${i}"]`).classList.add('active');
        }

        prevBtn.style.display = step === 1 ? 'none' : 'block';
        if (step === steps.length) {
            nextBtn.style.display = 'none';
            submitBtn.style.display = 'block';
        } else {
            nextBtn.style.display = 'block';
            submitBtn.style.display = 'none';
        }
    }

    // Mettre à jour le flowiseId quand un profil est sélectionné
    document.querySelectorAll('input[name="profile_type"]').forEach(radio => {
        radio.addEventListener('change', (e) => {
            const flowid = e.target.dataset.flowid;
            if (flowid) {
                flowiseIdInput.value = flowid;
            }
        });
    });

    nextBtn.addEventListener('click', () => {
        const currentStepEl = document.querySelector(`.wizard-step[data-step="${currentStep}"]`);
        const selectedOption = currentStepEl.querySelector('input[type="radio"]:checked');
        
        if (!selectedOption) {
            alert('Veuillez sélectionner une option pour continuer');
            return;
        }
        
        if (currentStep < steps.length) {
            currentStep++;
            updateStep(currentStep);
        }
    });

    prevBtn.addEventListener('click', () => {
        if (currentStep > 1) {
            currentStep--;
            updateStep(currentStep);
        }
    });

    form.addEventListener('submit', (e) => {
        const allSteps = Array.from(steps);
        const allFilled = allSteps.every(step => {
            const radio = step.querySelector('input[type="radio"]:checked');
            return radio !== null;
        });

        if (!allFilled) {
            e.preventDefault();
            alert('Veuillez remplir toutes les étapes avant de créer le chatbot');
        }
    });
});
</script>

<%- include('../layouts/footer') %></content>